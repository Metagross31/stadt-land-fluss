(this["webpackJsonpstadt-land-fluss"]=this["webpackJsonpstadt-land-fluss"]||[]).push([[10],{180:function(e,t,n){"use strict";n.d(t,"l",(function(){return l})),n.d(t,"k",(function(){return d})),n.d(t,"j",(function(){return h})),n.d(t,"g",(function(){return p})),n.d(t,"n",(function(){return f})),n.d(t,"e",(function(){return b})),n.d(t,"d",(function(){return m})),n.d(t,"c",(function(){return j})),n.d(t,"h",(function(){return y})),n.d(t,"i",(function(){return O})),n.d(t,"m",(function(){return x})),n.d(t,"a",(function(){return P})),n.d(t,"b",(function(){return w})),n.d(t,"f",(function(){return R}));var a=n(16),r=n(181),i=n(188),s=n(201),o=n.n(s),c=n(76),u=n(51),l=function(e,t){if(e>t.length)throw new Error("Cannot create more randomn unique letters than the number of possibleLetters provided!");for(var n=[],a=Object(r.a)(t),i=function(e){var t=o()(a);n.push(t),a=a.filter((function(e){return e!==t}))},s=0;s<e;s++)i();return n},d=function(e,t,n){for(var a=Object(r.a)(n),i=e-n.length,s=t.filter((function(e){return!n.includes(e)})),c=function(e){var t=o()(s);a.push(t),s=s.filter((function(e){return e!==t}))},u=0;u<i;u++)c();return a},h=function(e){return Array.from(e).map((function(e){return e[1]})).sort((function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0}))},p=function(e){return Object(u.e)(e,{points:c.s,star:!1,text:"",valid:!0})},f=function(e){return e.map((function(e){return Object(a.a)(Object(a.a)({},e),{},{text:e.text.trim(),valid:!!e.text})}))},b=function(e,t){var n=new Map;return e.forEach((function(a){var r=[];t.forEach((function(){var t=new Map;e.forEach((function(e){t.set(e.id,!0)})),r.push(t)})),n.set(a.id,r)})),n},m=function(e,t){if(e.checkForDuplicates||e.onlyPlayerWithValidAnswer)for(var n=t.keys().next().value,a=t.get(n),r=0;r<a.length;r++)j(e,t,r)},j=function(e,t,n){(e.checkForDuplicates||e.onlyPlayerWithValidAnswer)&&Array.from(t.keys()).forEach((function(a){var r=t.get(a);r[n].valid&&(e.onlyPlayerWithValidAnswer&&g(a,t,n)?r[n].points=c.n:e.checkForDuplicates&&v(a,t,n)?r[n].points=c.o:r[n].points=c.s)}))},g=function(e,t,n){var a=Array.from(t.keys()).filter((function(t){return t!==e})),r=!0;return a.forEach((function(e){return r=r&&!t.get(e)[n].valid})),r},v=function(e,t,n){var a=Array.from(t.keys()).filter((function(t){return t!==e})),r=t.get(e)[n].text.toLowerCase().replace(/[^0-9a-z]/gi,"");return Object(i.some)(a,(function(e){var a=t.get(e)[n];return a.valid&&r===a.text.toLowerCase().replace(/[^0-9a-z]/gi,"")}))},y=function(e){return e<=3?1:2},O=function(e){var t=0;return e.forEach((function(e){return t=e?t:t+1})),t},x=function(e,t){var n=new Map;return e.forEach((function(e,a){if(!e){var r=t.get(a);r&&n.set(a,r)}})),h(n)},P=function(e,t){t.forEach((function(t){t.forEach((function(t){t.valid?e.creativeAnswersExtraPoints&&t.star&&(t.points=t.points+c.d):t.points=0}))}))},w=function(e,t){var n=[],a={};return e.forEach((function(e,t){return a[t]={playerName:e.name,points:0}})),t.forEach((function(e){e.forEach((function(e,t){var n=e.reduce((function(e,t){return e+t.points}),0);a[t].points+=n}))})),Object.keys(a).forEach((function(e){return n.push(a[e])})),n.sort((function(e,t){return t.points-e.points}))},R=function(e,t,n){var a=[];return n.forEach((function(n){n.forEach((function(n,r){var i=e.get(r);n.forEach((function(e,n){e.valid&&e.star&&a.push({category:t.categories[n],playerName:i.name,text:e.text})}))}))})),a}},189:function(e,t,n){"use strict";var a,r;n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r})),function(e){e.checkForDuplicates="checkForDuplicates",e.creativeAnswersExtraPoints="creativeAnswersExtraPoints",e.onlyPlayerWithValidAnswer="onlyPlayerWithValidAnswer"}(a||(a={})),function(e){e.allPlayersSubmit="allPlayers",e.countdownEnds="countdownEnds",e.firstPlayerSubmits="firstPlayer"}(r||(r={}))},203:function(e,t,n){"use strict";var a=n(2),r=n(0),i=n.n(r),s=n(76);t.a=function(e){var t=e.rules;return t.checkForDuplicates||t.onlyPlayerWithValidAnswer||t.creativeAnswersExtraPoints?Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsx)("p",{className:"bold-text",children:"Regeln f\xfcr die Punktevergabe:"}),Object(a.jsxs)("ul",{children:[t.checkForDuplicates?Object(a.jsx)("li",{children:s.e.checkForDuplicates}):null,t.onlyPlayerWithValidAnswer?Object(a.jsx)("li",{children:s.e.onlyPlayerWithValidAnswer}):null,t.creativeAnswersExtraPoints?Object(a.jsx)("li",{children:s.e.creativeAnswersExtraPoints}):null]})]}):null}},243:function(e,t,n){},245:function(e,t,n){e.exports={textfield_wrapper:"PhaseEvaluateRound_textfield_wrapper__1vvD2",textfield_wrapper_creative:"PhaseEvaluateRound_textfield_wrapper_creative__ZkHJB",player_name:"PhaseEvaluateRound_player_name__3vIEv",answer:"PhaseEvaluateRound_answer__26B5S",invalid_answer:"PhaseEvaluateRound_invalid_answer__24pkd",button_wrapper:"PhaseEvaluateRound_button_wrapper__2ww_I",points_wrapper:"PhaseEvaluateRound_points_wrapper__d9qw8",points:"PhaseEvaluateRound_points__38f4X",search_link:"PhaseEvaluateRound_search_link__1u1C7",auto_reject_icon:"PhaseEvaluateRound_auto_reject_icon__aG-MH"}},253:function(e,t,n){},254:function(e,t,n){e.exports={link_label:"JoinGameLink_link_label__1tx1j"}},256:function(e){e.exports=JSON.parse('{"publishKey":"pub-c-cea13e04-e3aa-434b-806f-fc890fbd45bf","subscribeKey":"sub-c-66cfccd4-6c89-11ea-a7c4-5e95b827fd71"}')},306:function(e,t,n){"use strict";n.r(t);var a,r=n(16),i=n(181),s=n(39),o=n(40),c=n(44),u=n(43),l=n(2),d=n(188),h=n(238),p=n.n(h),f=n(214),b=n(0),m=n.n(b),j=n(28),g=n(184),v=n(313),y=n(284),O=n(285),x=n(286),P=n(167),w=n(166),R=n(142),C=n(171),I=n(292),k=n(293),E=n(128),S=n(242),A=n.n(S),F=n(197),N=n.n(F),_=n(180),M=Object(E.a)({adminPanel:{position:"absolute",top:"1rem",right:"1rem"},menuButton:{background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,255,255,0.5) 35%, rgba(255,255,255,0) 60%);"},dialogContent:{maxWidth:"23rem"},dialogContentText:{color:"black"}}),D=function(e){var t=M(),n=e.onClose,a=e.open;return Object(l.jsxs)(v.a,{onClose:function(){return n(!1)},open:a,children:[Object(l.jsx)(y.a,{classes:{root:t.dialogContent},children:e.playerToBeKicked?Object(l.jsxs)(O.a,{classes:{root:t.dialogContentText},children:['"With great power comes great responsibility" \u2013 Willst du ',e.playerToBeKicked.name," wirklich aus dem Spiel werfen?"]}):null}),Object(l.jsxs)(x.a,{children:[Object(l.jsx)(P.a,{type:"button",onClick:function(){return n(!1)},children:"Abbrechen"}),Object(l.jsx)(P.a,{type:"button",color:"primary",onClick:function(){return n(!0)},children:"Rauswerfen"})]})]})},T=function(e){var t=M(),n=Object(b.useState)(null),a=Object(g.a)(n,2),r=a[0],i=a[1],s=Object(b.useState)(!1),o=Object(g.a)(s,2),c=o[0],u=o[1],d=Object(b.useState)(null),h=Object(g.a)(d,2),p=h[0],f=h[1],m=new Map;e.allPlayers.forEach((function(e,t){e.isAdmin||m.set(t,e)}));var j=Object(_.j)(m);return Object(l.jsxs)("div",{className:t.adminPanel,children:[Object(l.jsx)(w.a,{className:t.menuButton,title:"Admin-Panel","aria-label":"Admin-Panel","aria-controls":"admin-panel","aria-haspopup":"true",onClick:function(e){i(e.currentTarget)},children:Object(l.jsx)(N.a,{color:"primary"})}),Object(l.jsx)(R.a,{id:"admin-panel",anchorEl:r,keepMounted:!0,open:Boolean(r),onClose:function(){i(null)},children:j.map((function(e,t){return Object(l.jsxs)(C.a,{title:"".concat(e.name," aus dem Spiel werfen"),onClick:function(){return t=e,i(null),f(t),void u(!0);var t},children:[Object(l.jsx)(I.a,{children:Object(l.jsx)(A.a,{color:"secondary"})}),Object(l.jsx)(k.a,{primary:e.name})]},"menu-item-delete-player-".concat(t))}))}),Object(l.jsx)(D,{open:c,playerToBeKicked:p,onClose:function(t){u(!1),t&&p&&e.kickPlayer(p.id)}})]})},G=(n(243),n(76)),L=n(47),W=function(){function e(t,n){Object(s.a)(this,e),this.x=t,this.y=n,this.radius=3.5}return Object(o.a)(e,[{key:"draw",value:function(e){e.save(),e.translate(this.x,this.y),e.fillStyle="white",e.fillRect(0,0,this.radius,this.radius),e.restore()}}]),e}(),z=function(){function e(t,n){var a=this;Object(s.a)(this,e),this.letters=t,this.callbackWhenAnimationDone=n,this.canvas=void 0,this.ctx=void 0,this.currentPos=void 0,this.width=void 0,this.height=void 0,this.particlePositions=void 0,this.particles=void 0,this.tmpCanvas=void 0,this.tmpCtx=void 0,this.time=void 0,this.counter=0,this.myInterval=void 0,this.activeTheme=void 0,this.animate=function(){requestAnimationFrame(a.animate),a.ctx.fillStyle=a.activeTheme.animationBackgroundColor,a.ctx.fillRect(0,0,a.width,a.height),a.animateParticles()},this.canvas=document.querySelector("#letter-animation-canvas"),this.ctx=this.canvas.getContext("2d");var r=document.querySelector("main");this.activeTheme=L.a.find((function(e){return r.classList.contains(e.className)})),this.width=r.offsetWidth,this.height=r.offsetHeight,this.particlePositions=[],this.particles=[],this.tmpCanvas=document.createElement("canvas"),this.tmpCtx=this.tmpCanvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,this.particlePositions=[],this.currentPos=0,this.time=""}return Object(o.a)(e,[{key:"init",value:function(){var e=this;this.myInterval=setInterval((function(){e.counter<e.letters.length&&(e.changeLetter(),e.getPixels(e.tmpCanvas,e.tmpCtx)),e.counter++,e.counter>e.letters.length+1&&(clearInterval(e.myInterval),e.callbackWhenAnimationDone())}),G.h),this.makeParticles(1e3),this.animate()}},{key:"changeLetter",value:function(){this.time=this.letters[this.currentPos],this.currentPos++,this.currentPos>=this.letters.length&&(this.currentPos=0)}},{key:"makeParticles",value:function(e){for(var t=0;t<=e;t++){var n=this.width/2+400*Math.random()-200,a=this.height/2+400*Math.random()-200;this.particles.push(new W(n,a))}}},{key:"getPixels",value:function(e,t){var n=this.time;e.width=window.innerWidth,e.height=window.innerHeight,t.fillStyle="red",t.font="italic bold 330px Noto Serif",t.fillText(n,e.width/2-t.measureText(n).width/2,e.height/2+100);var a=t.getImageData(0,0,e.width,e.height),r=new Uint32Array(a.data.buffer);this.particlePositions.length>0&&(this.particlePositions=[]);for(var i=0;i<e.height;i+=6)for(var s=0;s<e.width;s+=6)r[i*e.width+s]&&this.particlePositions.push({x:s,y:i})}},{key:"animateParticles",value:function(){for(var e,t,n=0,a=this.particles.length;n<a;n++)e=this.particles[n],t=this.particlePositions[n],this.particles.indexOf(e)===this.particlePositions.indexOf(t)&&(e.x+=.3*(t.x-e.x),e.y+=.3*(t.y-e.y),e.draw(this.ctx))}}]),e}(),V=function(e){var t=Object(i.a)(G.p).filter((function(t){return t!==e.letterToUnveil})),n=[].concat(Object(i.a)(Object(_.l)(G.g-1,t)),[e.letterToUnveil]);return Object(b.useEffect)((function(){new z(n,e.callbackWhenAnimationDone).init()})),Object(l.jsx)("canvas",{id:"letter-animation-canvas"})},B=n(90),K=n(6),q=n(177),U=n(294),H=n(318),J=n(316),Z=n(305),X=n(130),Q=n(175),Y=n(249),$=n.n(Y),ee=n(250),te=n.n(ee),ne=n(247),ae=n.n(ne),re=n(190),ie=n.n(re),se=n(248),oe=n.n(se),ce=n(196),ue=n.n(ce),le=n(244),de=n.n(le),he=Object(E.a)({centerContent:{display:"flex",justifyContent:"center"},chip:{height:"3rem",marginBottom:"0",marginTop:"1rem",borderRadius:"5px",fontWeight:"normal",fontSize:"1.2rem",boxShadow:"0 2px 4px rgba(0,0,0,.501961)"}}),pe=function(e){var t=he(),n=e.currentLetter,a=e.currentRound,r=e.numberOfRounds;return Object(l.jsx)("div",{className:t.centerContent,children:Object(l.jsx)(J.a,{color:"primary",component:"h2",icon:Object(l.jsx)(de.a,{}),label:"Runde ".concat(a," von ").concat(r,": \u201e").concat(n,"\u201c"),className:t.chip})})},fe=n(78),be=n(245),me=n.n(be),je=Object(K.a)((function(e){return Object(q.a)({badge:{right:-3,top:"100%",border:"2px solid ".concat(e.palette.background.paper),padding:"0 4px"}})}))(U.a),ge=function(e){var t=Object(b.useState)(e.playersThatFinishedEvaluation.has(e.playerInfo.id)),n=Object(g.a)(t,2),a=n[0],r=n[1],i=Object(b.useState)(!1),s=Object(g.a)(i,2),o=s[0],c=s[1],u=Object(b.useState)(""),d=Object(g.a)(u,2),h=d[0],p=d[1],f=e.allPlayers,j=e.currentRound,v=e.currentRoundEvaluation,y=e.gameConfig,O=e.playerInfo,x=e.playersThatFinishedEvaluation,P=e.gameRounds[j-1],R=y.letters[j-1],C=Object(_.j)(f),I=[];C.forEach((function(e){x.has(e.id)||I.push(e.name)}));var k=function(e){p(e),c(!0)},E=function(t,n){var r=C[n],i=v.get(r.id)[t],s=i.get(O.id),o=Object(_.m)(i,f),c=0===o.length?"Keine Ablehnungen":"Abgelehnt von "+o.map((function(e){return e.name})).join(", "),u=!!P.get(r.id)[t].text,d=Object(l.jsx)(H.a,{title:c,children:Object(l.jsx)(w.a,{className:"slf-evaluation-button",color:s?"default":"secondary",size:"small",onClick:function(){return function(t,n,r){a?k("Du hast bereits die Bewertung der Runde best\xe4tigt!"):e.updateEvaluationOfPlayerInput({categoryIndex:t,evaluatedPlayerId:n,markedAsValid:!r})}(t,r.id,s)},children:Object(l.jsx)(je,{badgeContent:o.length,color:"secondary",children:Object(l.jsx)(ue.a,{fontSize:"small"})})})},"slf-evaluation-tooltip-".concat(t,"-").concat(n)),h=Object(l.jsx)(H.a,{title:"Automatisch abgelehnt",children:Object(l.jsx)(ue.a,{color:"secondary",className:me.a.auto_reject_icon,fontSize:"small"})},"slf-evaluation-tooltip-".concat(t,"-").concat(n));return u?d:h},S=function(e,t){var n=y.categories[e],a=C[t],r=P.get(a.id)[e].text,i="https://www.ecosia.org/search?q=".concat(encodeURIComponent(n),"+").concat(encodeURIComponent(r));return Object(l.jsx)("a",{className:me.a.search_link,href:i,target:"_blank",rel:"noopener noreferrer","aria-label":"Begriff nachschlagen",children:Object(l.jsx)(H.a,{title:"Begriff nachschlagen",placement:"bottom",children:Object(l.jsx)(ae.a,{color:"primary",fontSize:"small"})})})},A=function(t,n){var r=C[n],i=P.get(r.id)[t];return Object(l.jsx)(H.a,{title:i.star?"Besonders kreativ? Nope!":"Als besonders kreativ markieren",placement:"bottom",children:Object(l.jsx)(w.a,{color:"primary",size:"small",onClick:function(){return function(t,n,r){a?k("Du hast bereits die Bewertung der Runde best\xe4tigt!"):e.playerInfo.id===n?k("Nice try! Ob deine eigene Antwort sehr kreativ oder lustig ist, sollen die anderen beurteilen."):e.updateIsPlayerInputVeryCreativeStatus({categoryIndex:t,evaluatedPlayerId:n,markedAsCreative:!r})}(t,r.id,i.star)},children:i.star?Object(l.jsx)(ie.a,{}):Object(l.jsx)(oe.a,{})})})},F=function(e){var t="+"+(e.valid?function(e){return y.scoringOptions.creativeAnswersExtraPoints&&e.star?e.points+G.d:e.points}(e):0),n=e.valid?"primary":"default";return Object(l.jsx)("div",{className:me.a.points_wrapper,children:Object(l.jsx)(J.a,{label:t,color:n,classes:{root:me.a.points}})})};return Object(l.jsxs)(m.a.Fragment,{children:[Object(l.jsx)(pe,{currentLetter:R,currentRound:j,numberOfRounds:y.numberOfRounds}),y.categories.map((function(e,t){return Object(l.jsxs)("div",{className:"material-card-style",children:[Object(l.jsx)(fe.a,{isH3:!0,showDivider:!1,text:e}),C.map((function(e,n){return function(e,t){var n=C[t],a=P.get(n.id)[e],r=!!a.text,i=a.valid,s=i&&a.star;return Object(l.jsxs)(Z.a,{boxShadow:1,className:s?me.a.textfield_wrapper_creative:me.a.textfield_wrapper,children:[Object(l.jsx)("h4",{className:me.a.player_name,children:n.name}),Object(l.jsx)(X.a,{light:!0}),Object(l.jsx)("p",{className:i?me.a.answer:me.a.invalid_answer,children:r?a.text:"(leer)"}),Object(l.jsxs)("div",{className:me.a.button_wrapper,children:[r?S(e,t):null,i?A(e,t):null,E(e,t)]}),F(a)]},"slf-evaluation-textfield-wrapper-".concat(e,"-").concat(t))}(t,n)}))]},"slf-evaluation-for-category-no-"+t)})),Object(l.jsxs)("div",{className:"material-card-style",children:["Best\xe4tigung ausstehend: ",Object(l.jsx)("span",{className:"bold-text",children:I.join(", ")})]}),Object(l.jsx)(w.a,{type:"button",className:"fixed-bottom-right-button",color:"secondary",title:"Best\xe4tigen","aria-label":"Best\xe4tigen",onClick:function(){a||(r(!0),e.sendEvaluationFinishedMessage())},children:a?Object(l.jsx)($.a,{}):Object(l.jsx)(te.a,{})}),Object(l.jsx)(Q.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:o,autoHideDuration:3e3,onClose:function(){return c(!1)},message:h})]})},ve=n(307),ye=n(295),Oe=n(252),xe=n.n(Oe),Pe=n(189),we=n(251),Re=Object(E.a)((function(e){return Object(q.a)({countdown:{position:"fixed",right:"1.5rem",bottom:"1rem",backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,padding:"0.5rem 1rem",fontSize:"1.5rem",boxShadow:"0 2px 4px rgba(0, 0, 0, .401961)",borderRadius:"5px"}})})),Ce=function(e){var t=Re();return Object(l.jsx)(we.a,{date:Date.now()+1e3*e.duration,renderer:function(e){return Object(l.jsxs)("div",{className:t.countdown,children:[Object(we.b)(e.minutes),":",Object(we.b)(e.seconds)]})},onComplete:e.onComplete})},Ie=m.a.memo(Ce),ke=function(e){var t=e.currentRound,n=e.gameConfig,a=e.gameRoundInputs,s=n.letters[t-1],o=Object(l.jsx)(w.a,{type:"button",className:"fixed-bottom-right-button",color:"secondary",title:"Abschicken","aria-label":"Abschicken",onClick:e.finishRoundOnUserAction,children:Object(l.jsx)(xe.a,{})}),c=Object(l.jsx)(Ie,{duration:e.gameConfig.durationOfCountdown,onComplete:e.finishRoundOnCountdownComplete});return Object(l.jsxs)(m.a.Fragment,{children:[Object(l.jsx)(pe,{currentLetter:s,currentRound:t,numberOfRounds:n.numberOfRounds}),Object(l.jsxs)("form",{className:"app-form",noValidate:!0,autoComplete:"off",children:[n.categories.map((function(t,n){var o="slf-input-for-category-no-"+n,c="".concat(t," mit Buchstabe (").concat(s,")");return Object(l.jsxs)("div",{className:"material-card-style",children:[Object(l.jsx)(fe.a,{isH3:!0,showDivider:!1,text:t}),Object(l.jsx)("label",{htmlFor:o,className:"sr-only",children:c}),Object(l.jsx)(ve.a,{value:a[n].text,variant:"outlined",fullWidth:!0,InputProps:{id:o,startAdornment:Object(l.jsxs)(ye.a,{position:"start",children:[s,":"]}),spellCheck:!1},onChange:function(t){return function(t,n){var s=Object(i.a)(a);s[n]=Object(r.a)(Object(r.a)({},s[n]),{},{text:t.target.value}),e.updateCurrentRoundInputs(s)}(t,n)}})]},o)})),n.endRoundMode===Pe.a.countdownEnds?c:o]})]})},Ee=(n(253),n(255)),Se=n.n(Ee);!function(e){e.currentRoundInputs="currentRoundInputs",e.dataForCurrentGame="dataForCurrentGame",e.evaluationFinished="evaluationFinished",e.evaluationOfPlayerInput="evaluationOfPlayerInput",e.isPlayerInputVeryCreative="isPlayerInputVeryCreative",e.kickPlayer="kickPlayer",e.requestGameData="requestGameData",e.roundFinished="roundFinished",e.startGame="startGame"}(a||(a={}));var Ae=function(){function e(t){Object(s.a)(this,e),this.payload=t}return Object(o.a)(e,[{key:"toPubNubMessage",value:function(){return{type:a.currentRoundInputs,payload:this.payload}}}]),e}(),Fe=function(){function e(t){Object(s.a)(this,e),this.payload=t}return Object(o.a)(e,[{key:"toPubNubMessage",value:function(){return{type:a.evaluationOfPlayerInput,payload:this.payload}}}]),e}(),Ne=function(){function e(t){Object(s.a)(this,e),this.payload=t}return Object(o.a)(e,[{key:"toPubNubMessage",value:function(){return{type:a.isPlayerInputVeryCreative,payload:this.payload}}}]),e}(),_e=function(){function e(t){Object(s.a)(this,e),this.payload=t}return Object(o.a)(e,[{key:"toPubNubMessage",value:function(){return{type:a.kickPlayer,payload:this.payload}}}]),e}(),Me=function(){function e(t){Object(s.a)(this,e),this.payload=t}return Object(o.a)(e,[{key:"toPubNubMessage",value:function(){return{type:a.dataForCurrentGame,payload:this.payload}}}]),e}(),De=n(315),Te=n(195),Ge=n.n(Te),Le=n(51),We=n(254),ze=n.n(We),Ve=function(e){var t=Object(b.useState)(!1),n=Object(g.a)(t,2),a=n[0],r=n[1],i=window.location.href,s=i.slice(0,i.length-5)+"/joingame?id="+e.gameId;return Object(l.jsxs)(m.a.Fragment,{children:[Object(l.jsx)("p",{className:ze.a.link_label,children:"Teile diesen Link mit Freunden:"}),Object(l.jsx)(De.a,{name:"idInput",value:s,className:"app-form-input",disabled:!0,fullWidth:!0,endAdornment:Object(l.jsx)(ye.a,{position:"end",children:Object(l.jsx)(w.a,{title:"Link kopieren","aria-label":"Link kopieren",onClick:function(){Object(Le.d)(s),r(!0)},children:Object(l.jsx)(Ge.a,{})})})}),Object(l.jsx)(Q.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:a,autoHideDuration:1500,onClose:function(){r(!1)},message:"Der Link wurde in Zwischenablage kopiert."})]})},Be=n(202),Ke=n.n(Be),qe=Object(E.a)((function(e){return Object(q.a)({root:{display:"flex",flexWrap:"wrap",padding:e.spacing(.5)},chip:{margin:e.spacing(.5)}})})),Ue=function(e){var t=qe(),n=Object(_.j)(e.players);return Object(l.jsx)("div",{className:t.root,children:n.map((function(e,n){return Object(l.jsx)(J.a,{icon:Object(l.jsx)(Ke.a,{}),color:e.isAdmin?"secondary":"primary",label:e.isAdmin?"".concat(e.name," (Admin)"):e.name,className:t.chip},"player-name-".concat(n))}))})},He=n(203),Je=function(e){var t=e.allPlayers,n=e.gameId,r=e.playerInfo,i=e.gameConfig,s=Object(l.jsxs)("p",{className:"wait-for-start-animation",children:["Warte auf Spielbeginn ",Object(l.jsx)("span",{children:"."}),Object(l.jsx)("span",{children:"."}),Object(l.jsx)("span",{children:"."})]}),o=function(e){switch(e.endRoundMode){case Pe.a.allPlayersSubmit:return"Wenn alle Spielenden ihre Antworten abgeschickt haben";case Pe.a.countdownEnds:return"Countdown (".concat(e.durationOfCountdown," Sekunden)");case Pe.a.firstPlayerSubmits:return"Schnellster Spieler";default:return""}};return Object(l.jsxs)(m.a.Fragment,{children:[Object(l.jsxs)("div",{className:"material-card-style",children:[Object(l.jsx)(fe.a,{isH3:!1,showDivider:!0,text:"Gleich geht's los..."}),Object(l.jsxs)("div",{className:"players-wrapper",children:[Object(l.jsxs)("h3",{children:["Mitspieler (",e.allPlayers.size,"):"]}),Object(l.jsx)(Ue,{players:e.allPlayers})]}),e.gameConfig?Object(l.jsxs)(m.a.Fragment,{children:[Object(l.jsx)(X.a,{}),Object(l.jsx)("h3",{children:"Spieleinstellungen:"}),Object(l.jsxs)("p",{children:[Object(l.jsx)("span",{className:"bold-text",children:"ID:"})," ",e.gameId]}),Object(l.jsxs)("p",{children:[Object(l.jsx)("span",{className:"bold-text",children:"Runden:"})," ",i.numberOfRounds]}),Object(l.jsxs)("p",{children:[Object(l.jsx)("span",{className:"bold-text",children:"Kategorien:"})," ",i.categories.join(", ")]}),Object(l.jsxs)("p",{children:[Object(l.jsx)("span",{className:"bold-text",children:"Beenden der Runde durch:"}),Object(l.jsxs)("span",{children:[" ",o(i)]})]}),Object(l.jsx)(He.a,{rules:i.scoringOptions})]}):null,Object(l.jsx)(X.a,{}),r.isAdmin?Object(l.jsx)("div",{className:"button-wrapper add-margin-top",children:Object(l.jsx)(P.a,{color:"primary",variant:"contained",size:"large",startIcon:Object(l.jsx)(Se.a,{}),disabled:t.size<G.l,onClick:function(){return e.sendMessage({type:a.startGame})},children:"Starten"})}):s]}),r.isAdmin?Object(l.jsx)("div",{className:"material-card-style",children:Object(l.jsx)(Ve,{gameId:n})}):null]})},Ze=function(e){var t=Object(f.b)(),n=function(){var n;n=e.playerInfo.isAdmin?{gameConfig:e.gameConfig,playerInfo:e.playerInfo}:{playerInfo:e.playerInfo},t.setState({channels:[e.gameChannel],state:n})},a=function(){t.hereNow({channels:[e.gameChannel],includeUUIDs:!0,includeState:!0},(function(t,n){if(console.log("PubNub hereNow",n),e.isRejoiningGame&&n.totalOccupancy<=1)e.navigateToDashboard();else{var a=n.channels[e.gameChannel];if(a){var r=[];a.occupants.forEach((function(e){var t=e.state;t&&t.playerInfo&&r.push(t)})),e.addPlayers.apply(e,r)}}}))};return Object(b.useEffect)((function(){var r={message:function(t){console.log("PubNub message event",t),t.message.type&&e.processPubNubMessage(t)},presence:function(t){if(console.log("PubNub presence event",t),"state-change"===t.action){var n=t.state;n.playerInfo.id!==e.playerInfo.id&&e.addPlayers(n)}},status:function(r){console.log("PubNub status event",r),"PNConnectedCategory"===r.category&&(console.log("Player is connected to PubNub game channel"),t.history({channel:e.gameChannel,count:10},(function(t,r){!e.isRejoiningGame&&r.messages.length>0?e.navigateToDashboard():e.isRejoiningGame||(n(),a(),setTimeout(a,3e3))})))}};return t.addListener(r),t.subscribe({channels:[e.gameChannel],withPresence:!0}),function(){t.removeListener(r),t.unsubscribeAll()}})),null},Xe=m.a.memo(Ze),Qe=n(256),Ye={publishKey:Qe.publishKey,subscribeKey:Qe.subscribeKey,uuid:void 0,ssl:!0},$e=n(20),et=n(29),tt=function(e,t,n){if(e.id===n)return!1;if(e.isAdmin)return!0;var a=t.get(n);if(a&&a.isAdmin){var r=Object(d.cloneDeep)(t);return r.delete(n),Array.from(r).map((function(e){return e[1]})).sort((function(e,t){return e.id<t.id?-1:e.id>t.id?1:0}))[0].id===e.id}return!1},nt=function(e,t){var n=new Map;e.forEach((function(e,a){n.set(a,e.map((function(e){var n=[];return t.forEach((function(t){return n.push(e.get(t.id))})),n})))}));var a=[];return t.forEach((function(e){return a.push(n.get(e.id))})),a},at=function(e,t){var n=new Map;return t.forEach((function(a,r){var i=e[r].map((function(e){var n=new Map;return t.forEach((function(t,a){return n.set(t.id,e[a])})),n}));n.set(a.id,i)})),n},rt=function(e,t){var n=[];return t.forEach((function(t){var a=e.get(t.id);n.push(a.map((function(e){return e.star})))})),n},it=function(e){for(var t=[],n=1;n<=e;n++){var a=Object(et.e)(n);a&&t.push(a)}return t},st=function(e,t,n,a){a.forEach((function(e,a){var r=t.get(a);e.forEach((function(e,t){e.valid&&(e.valid=Object(_.i)(r[t])<n)}))})),Object(_.d)(e,a)},ot=function(e,t,n){t.forEach((function(t,a){var r=e[a];n.get(t.id).forEach((function(e,t){return e.star=r[t]}))}))},ct=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(e=t.call.apply(t,[this].concat(o))).state={allPlayers:new Map,currentPhase:G.f.waitingToStart,currentRound:1,currentRoundEvaluation:new Map,currentRoundInputs:[],gameConfig:null,gameRounds:[new Map],playersThatFinishedEvaluation:new Map,playersThatFinishedRound:new Map,showLetterAnimation:!1,showLoadingScreen:!0},e.pubNubClient=void 0,e.sendMessage=function(t){e.pubNubClient.publish({channel:e.props.gameId,message:t,storeInHistory:!0,ttl:1},(function(e,t){return console.log("PubNub Publish:",e,t)}))},e.createCurrentPhaseElement=function(){switch(e.state.currentPhase){case G.f.waitingToStart:return Object(l.jsx)(Je,{allPlayers:e.state.allPlayers,gameConfig:e.state.gameConfig,gameId:e.props.gameId,playerInfo:e.props.playerInfo,sendMessage:e.sendMessage});case G.f.fillOutTextfields:return Object(l.jsx)(ke,{currentRound:e.state.currentRound,gameConfig:e.state.gameConfig,gameRoundInputs:e.state.currentRoundInputs,updateCurrentRoundInputs:e.updateCurrentRoundInputs,finishRoundOnCountdownComplete:e.finishRoundOnCountdownComplete,finishRoundOnUserAction:e.finishRoundOnUserAction});case G.f.evaluateRound:return Object(l.jsx)(ge,{allPlayers:e.state.allPlayers,currentRound:e.state.currentRound,currentRoundEvaluation:e.state.currentRoundEvaluation,gameConfig:e.state.gameConfig,gameRounds:e.state.gameRounds,playerInfo:e.props.playerInfo,playersThatFinishedEvaluation:e.state.playersThatFinishedEvaluation,sendEvaluationFinishedMessage:e.sendEvaluationFinishedMessage,updateEvaluationOfPlayerInput:e.updateEvaluationOfPlayerInput,updateIsPlayerInputVeryCreativeStatus:e.updateIsPlayerInputVeryCreativeStatus});default:return null}},e.callbackWhenAnimationDone=function(){e.setState({showLetterAnimation:!1})},e.navigateToDashboard=function(){Object(et.f)(),e.props.onResetAppState(),e.props.history.push("/")},e.getWaitingForPlayers=function(){var t=[];return Object(_.j)(e.state.allPlayers).forEach((function(n){e.state.playersThatFinishedRound.has(n.id)||t.push(n.name)})),t},e.addPlayers=function(){if(e.state.currentPhase===G.f.waitingToStart){for(var t=null,n=Object(d.cloneDeep)(e.state.allPlayers),a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];r.forEach((function(a){n.set(a.playerInfo.id,a.playerInfo),a.gameConfig&&!e.state.gameConfig&&(t=a.gameConfig)})),t?(Object(et.i)(t),e.setState({allPlayers:n,gameConfig:t,showLoadingScreen:!1})):e.setState({allPlayers:n})}},e.processPubNubMessage=function(t){var n=e.state.gameConfig,r=t.message;switch(r.type){case a.startGame:e.startGame();break;case a.roundFinished:if(n.endRoundMode===Pe.a.allPlayersSubmit){var i=Object(d.cloneDeep)(e.state.playersThatFinishedRound);i.set(t.publisher,!0),e.setState({playersThatFinishedRound:i}),t.publisher===e.props.playerInfo.id&&e.stopRoundAndSendInputs()}else e.stopRoundAndSendInputs();break;case a.currentRoundInputs:e.addPlayerInputForFinishedRound(t.publisher,r.payload);break;case a.evaluationOfPlayerInput:e.processEvaluationOfPlayerInput(t.publisher,r.payload);break;case a.isPlayerInputVeryCreative:e.processIsPlayerInputVeryCreativeStatus(r.payload);break;case a.evaluationFinished:e.countPlayerAsEvaluationFinished(t.publisher);break;case a.kickPlayer:e.removePlayerFromGame(r.payload);break;case a.requestGameData:tt(e.props.playerInfo,e.state.allPlayers,t.publisher)&&(e.state.allPlayers.has(t.publisher)?e.sendDataForCurrentGame(t.publisher):e.sendKickPlayerMessage(t.publisher));break;case a.dataForCurrentGame:e.restoreDataForCurrentGame(r.payload)}},e.startGame=function(){var t=e.state.gameConfig,n=Object(_.e)(e.state.allPlayers,t.categories);e.setState({currentPhase:G.f.fillOutTextfields,currentRoundEvaluation:n,currentRoundInputs:Object(_.g)(t.categories.length),showLetterAnimation:!0})},e.updateCurrentRoundInputs=function(t){e.setState({currentRoundInputs:t})},e.finishRoundOnCountdownComplete=function(){e.setState({showLoadingScreen:!0}),e.props.playerInfo.isAdmin&&e.sendMessage({type:a.roundFinished})},e.finishRoundOnUserAction=function(){var t=Object(d.cloneDeep)(e.state.playersThatFinishedRound);t.set(e.props.playerInfo.id,!0),e.setState({playersThatFinishedRound:t,showLoadingScreen:!0}),e.sendMessage({type:a.roundFinished})},e.stopRoundAndSendInputs=function(){var t=new Ae(Object(_.n)(e.state.currentRoundInputs));e.sendMessage(t.toPubNubMessage())},e.addPlayerInputForFinishedRound=function(t,n){var a=Object(d.cloneDeep)(e.state.gameRounds),r=e.state.currentRound-1;a[r].set(t,n),a[r].size===e.state.allPlayers.size?(Object(_.d)(e.state.gameConfig.scoringOptions,a[r]),Object(et.k)(e.state.currentRound,a[r]),e.setState({currentPhase:G.f.evaluateRound,gameRounds:a,showLoadingScreen:!1})):e.setState({gameRounds:a})},e.updateEvaluationOfPlayerInput=function(t){var n=new Fe(t);e.sendMessage(n.toPubNubMessage())},e.processEvaluationOfPlayerInput=function(t,n){if(e.state.allPlayers.has(t)){var a=n.categoryIndex,r=n.evaluatedPlayerId,i=n.markedAsValid,s=Object(d.cloneDeep)(e.state.currentRoundEvaluation),o=s.get(r);o[a].set(t,i);var c=Object(d.cloneDeep)(e.state.gameRounds),u=Object(_.i)(o[a])<Object(_.h)(e.state.allPlayers.size),l=c[e.state.currentRound-1];l.get(r)[a].valid=u,Object(_.c)(e.state.gameConfig.scoringOptions,l,a),e.setState({currentRoundEvaluation:s,gameRounds:c})}},e.updateIsPlayerInputVeryCreativeStatus=function(t){var n=new Ne(t);e.sendMessage(n.toPubNubMessage())},e.processIsPlayerInputVeryCreativeStatus=function(t){var n=t.categoryIndex,a=t.evaluatedPlayerId,r=t.markedAsCreative,i=Object(d.cloneDeep)(e.state.gameRounds);i[e.state.currentRound-1].get(a)[n].star=r,e.setState({gameRounds:i})},e.sendEvaluationFinishedMessage=function(){return e.sendMessage({type:a.evaluationFinished})},e.countPlayerAsEvaluationFinished=function(t){var n=Object(d.cloneDeep)(e.state.playersThatFinishedEvaluation);n.set(t,!0),n.size===e.state.allPlayers.size?e.processEvaluationsAndStartNextRoundOrFinishGame():e.setState({playersThatFinishedEvaluation:n})},e.processEvaluationsAndStartNextRoundOrFinishGame=function(){var t=e.state,n=t.allPlayers,a=t.currentRound,r=e.state.gameConfig,s=Object(d.cloneDeep)(e.state.gameRounds);Object(_.a)(r.scoringOptions,s[a-1]),a===r.numberOfRounds?(Object(et.f)(),e.props.onSetDataOfFinishedGame({allPlayers:n,gameConfig:r,gameRounds:s}),e.props.history.push("/results")):(Object(et.k)(e.state.currentRound,s[a-1]),e.setState({currentPhase:G.f.fillOutTextfields,currentRoundEvaluation:Object(_.e)(n,r.categories),currentRoundInputs:Object(_.g)(r.categories.length),currentRound:a+1,gameRounds:[].concat(Object(i.a)(s),[new Map]),playersThatFinishedEvaluation:new Map,playersThatFinishedRound:new Map,showLetterAnimation:!0}))},e.sendKickPlayerMessage=function(t){var n=new _e(t);e.sendMessage(n.toPubNubMessage())},e.removePlayerFromGame=function(t){if(e.props.playerInfo.id===t)return Object(et.f)(),e.props.onResetAppState(),void e.props.history.push("/");if(e.state.allPlayers.has(t)){var n=Object(d.cloneDeep)(e.state.allPlayers);n.delete(t);var a=Object(d.cloneDeep)(e.state.currentRoundEvaluation);a.delete(t);var r=Object(d.cloneDeep)(e.state.gameRounds);r.forEach((function(e){return e.delete(t)}));var i=Object(d.cloneDeep)(e.state.playersThatFinishedEvaluation);i.delete(t),e.setState({allPlayers:n,currentRoundEvaluation:a,gameRounds:r,playersThatFinishedEvaluation:i}),e.state.currentPhase===G.f.evaluateRound&&i.size===n.size&&e.processEvaluationsAndStartNextRoundOrFinishGame()}},e.sendDataForCurrentGame=function(t){var n=e.state,a=n.allPlayers,r=n.currentPhase,i=n.currentRound,s=n.currentRoundEvaluation,o=n.gameRounds,c=Object(_.j)(a),u=r===G.f.evaluateRound?nt(s,c):[],l=r===G.f.evaluateRound?rt(o[i-1],c):[],d=new Me({compressedGameRoundEvaluation:u,compressedMarkedAsCreativeFlags:l,currentPhase:r,currentRound:i,playersThatFinishedEvaluation:Object(Le.c)(e.state.playersThatFinishedEvaluation),requestingPlayerId:t,sortedPlayers:c});e.sendMessage(d.toPubNubMessage())},e.restoreDataForCurrentGame=function(t){if(e.props.playerInfo.id===t.requestingPlayerId){var n=Object(et.c)(),a=t.currentPhase===G.f.evaluateRound?t.currentRound:t.currentRound-1,r=it(a);if(n&&r.length===a){var i,s=new Map;if(t.sortedPlayers.forEach((function(e){return s.set(e.id,e)})),t.currentPhase===G.f.evaluateRound){var o=r[t.currentRound-1];i=at(t.compressedGameRoundEvaluation,t.sortedPlayers),st(n.scoringOptions,i,Object(_.h)(s.size),o),ot(t.compressedMarkedAsCreativeFlags,t.sortedPlayers,o)}else i=Object(_.e)(s,n.categories);e.setState({allPlayers:s,currentPhase:t.currentPhase,currentRound:t.currentRound,currentRoundEvaluation:i,currentRoundInputs:Object(_.g)(n.categories.length),gameConfig:n,gameRounds:r,playersThatFinishedEvaluation:Object(Le.a)(t.playersThatFinishedEvaluation),showLoadingScreen:!1})}else console.log("Error: Can't restore game session because data is missing in local storage!"),e.navigateToDashboard()}},e}return Object(o.a)(n,[{key:"render",value:function(){if(null===this.props.gameId||null===this.props.playerInfo)return null;this.pubNubClient||(this.pubNubClient=new p.a(Object(r.a)(Object(r.a)({},Ye),{},{uuid:this.props.playerInfo.id})));var e=Object(l.jsx)(V,{letterToUnveil:this.state.gameConfig?this.state.gameConfig.letters[this.state.currentRound-1]:"",callbackWhenAnimationDone:this.callbackWhenAnimationDone}),t=this.state,n=t.allPlayers,a=t.currentPhase,i=t.gameConfig,s=t.showLetterAnimation,o=t.showLoadingScreen,c=Object(l.jsx)(T,{allPlayers:n,kickPlayer:this.sendKickPlayerMessage}),u=a===G.f.fillOutTextfields&&i&&i.endRoundMode===Pe.a.allPlayersSubmit&&this.state.playersThatFinishedRound.size!==n.size?Object(l.jsx)(B.a,{waitingForPlayers:this.getWaitingForPlayers()}):Object(l.jsx)(B.a,{});return Object(l.jsxs)(f.a,{client:this.pubNubClient,children:[Object(l.jsx)(Xe,{gameChannel:this.props.gameId,gameConfig:this.props.gameConfig,isRejoiningGame:this.props.isRejoiningGame,playerInfo:this.props.playerInfo,navigateToDashboard:this.navigateToDashboard,addPlayers:this.addPlayers,processPubNubMessage:this.processPubNubMessage}),s?e:null,o?u:null,o||s?null:Object(l.jsx)("div",{className:"main-content-wrapper",children:this.createCurrentPhaseElement()}),this.props.playerInfo.isAdmin&&this.state.allPlayers.size>1?c:null]})}},{key:"componentDidMount",value:function(){var e=this.props,t=e.gameConfig,n=e.gameId,r=e.isRejoiningGame,i=e.playerInfo;if(null!==n&&null!==i)if(r)this.sendMessage({type:a.requestGameData});else{var s=new Map;s.set(i.id,i),i.isAdmin?(Object(et.i)(t),this.setState({allPlayers:s,gameConfig:t,showLoadingScreen:!1})):this.setState({allPlayers:s})}else this.props.history.push("/")}}]),n}(b.Component);t.default=Object(j.b)((function(e){return{gameConfig:e.gameConfig,gameId:e.gameId,isRejoiningGame:e.isRejoiningGame,playerInfo:e.playerInfo}}),(function(e){return{onSetDataOfFinishedGame:function(t){return e(Object($e.j)(t))},onResetAppState:function(){return e(Object($e.g)())}}}))(ct)}}]);
//# sourceMappingURL=10.203705df.chunk.js.map